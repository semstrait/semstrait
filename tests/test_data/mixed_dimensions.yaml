# Mixed Dimensions Test Fixture
# Tests: Some dimensions need JOINs, some are denormalized
#
# Expected behavior:
# - dates dimension: denormalized (year, month on fact table) - NO JOIN
# - customers dimension: joined (only customer_id on fact, need to join for name) - JOIN
# - Query for dates.year should NOT join
# - Query for customers.name should JOIN

semantic_models:
  - name: orders
    dimensions:
      # Only customers is a shared dimension table
      - name: customers
        source:
          type: parquet
          path: /data/sales/customers.parquet
        table: sales.customers
        attributes:
          - name: customer_id
            type: i32
          - name: name
            type: string
          - name: city
            type: string
          - name: email
            type: string
    
    metrics:
      - name: order_total
        expr: order_total
        type: f64
      - name: order_count
        expr: order_count
        type: i64
    
    dataset_groups:
      - name: order_facts
        dimensions:
          # Denormalized - columns are on fact table, no join needed
          # Note: no join spec = degenerate dimension
          - name: dates
            attributes:
              - name: order_date
                type: date
              - name: year
                type: i32
              - name: quarter
                type: string

          # Joined dimension - need to join for name, city
          - name: customers
            join:
              leftKey: customer_id
              rightKey: customer_id
            attributes:
              - name: customer_id
                type: i32
              - name: name
                type: string
              - name: city
                type: string

        measures:
          - name: order_total
            aggregation: sum
            expr: total_amount
            type: f64

          - name: order_count
            aggregation: count
            expr: order_id
            type: i64

        datasets:
          - dataset: sales.orders
            source:
              type: parquet
              path: /data/sales/orders.parquet
            dimensions:
              # Denormalized: all date columns are on fact table
              dates: [order_date, year, quarter]
              # Joined: only customer_id on fact, need join for name/city
              customers: [customer_id, name, city]
            measures: [order_total, order_count]
